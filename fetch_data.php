<?php // Enable CORS header("Access-Control-Allow-Origin: *"); header("Access-Control-Allow-Methods: GET, POST, OPTIONS"); header("Access-Control-Allow-Headers: Content-Type, Authorization"); // Database connection parameters $servername = "localhost"; // Host $username = "sacredh1_waterlevel"; // Database user $password = "6363081958@johnson"; // Database password $dbname = "sacredh1_waterlevel"; // Database name $port = 3306; // Port number // Create a connection to the MySQL database $conn = new mysqli($servername, $username, $password, $dbname, $port); // Check if the connection was successful if ($conn->connect_error) { die("Connection failed: " . $conn->connect_error); } // SQL query to fetch data from the TankData table including last_update field $sql = "SELECT level1, level2, Ackno, Buzzer, comd_resp, command, sen_status, last_update FROM TankData WHERE id = 1"; $result = $conn->query($sql); $data = array(); if ($result->num_rows > 0) { // Fetch the data and store it in the $data array while($row = $result->fetch_assoc()) { // Get the last update timestamp from the database $lastUpdate = strtotime($row['last_update']); $currentTime = time(); // Calculate if the last update was within the last 20 seconds (tolerance) $online = ($currentTime - $lastUpdate) <= 60 ? 1 : 0; // Add online status to the data $row['online'] = $online; // Add the row to the data array $data[] = $row; } } else { $data = null; // No data found } // Return the data as JSON header('Content-Type: application/json'); echo json_encode($data); // Close the connection to the database $conn->close(); ?>